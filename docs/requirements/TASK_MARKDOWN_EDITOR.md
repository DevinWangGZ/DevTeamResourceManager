# 任务描述Markdown编辑器需求设计

> **文档版本**：v1.0 | **创建日期**：2024-12 | **负责人**：项目组

## 一、需求概述

### 1.1 背景

当前任务创建功能使用弹窗（Dialog）形式，任务描述使用简单的文本域（textarea），无法支持富文本格式、图片上传等高级功能。为了提升任务描述的丰富性和可读性，需要将任务创建改为独立页面，并使用Markdown编辑器。

### 1.2 目标

- 将任务创建从弹窗改为独立页面，提供更好的编辑体验
- 任务描述支持Markdown格式，提升内容表达能力
- 支持图片上传和粘贴，方便插入截图、流程图等
- 支持常用Markdown操作（加粗、斜体、列表、代码块等）
- 实时预览功能，所见即所得

### 1.3 用户价值

- **项目经理**：可以创建更详细、更清晰的任务描述，包含图片、代码示例等
- **开发人员**：可以更清楚地理解任务需求，减少沟通成本
- **团队协作**：任务描述更专业，提升整体协作效率

---

## 二、功能需求

### 2.1 页面结构改造

#### 2.1.1 从弹窗改为独立页面

**当前实现**：
- 在任务列表页面（TaskList.vue）中使用 `el-dialog` 弹窗
- 弹窗宽度600px，空间有限
- 表单字段较多，需要滚动查看

**新实现**：
- 创建独立的任务创建页面（TaskCreate.vue）
- 使用全屏或大屏布局，提供充足的编辑空间
- 支持路由导航，URL为 `/tasks/create`
- 从任务列表页面点击"创建任务"按钮跳转到创建页面

**验收标准**：
- [ ] 任务创建页面独立存在，可通过路由访问
- [ ] 页面布局合理，编辑区域宽敞
- [ ] 从任务列表可以跳转到创建页面
- [ ] 创建完成后可以返回任务列表或查看任务详情

---

### 2.2 Markdown编辑器功能

#### 2.2.1 编辑器基础功能

**功能要求**：
- 支持Markdown语法编辑
- 实时预览功能（编辑和预览双栏显示）
- 语法高亮（代码块）
- 工具栏快捷操作（加粗、斜体、标题、列表等）
- 支持快捷键操作

**支持的Markdown语法**：
- 标题（H1-H6）：`# 标题`
- 加粗：`**文本**` 或 `__文本__`
- 斜体：`*文本*` 或 `_文本_`
- 删除线：`~~文本~~`
- 代码行内：`` `代码` ``
- 代码块：` ```语言 代码 ``` `
- 有序列表：`1. 项目`
- 无序列表：`- 项目` 或 `* 项目`
- 链接：`[文本](URL)`
- 引用：`> 引用内容`
- 表格：Markdown表格语法
- 水平线：`---` 或 `***`

**验收标准**：
- [ ] 编辑器界面友好，易于使用
- [ ] 所有Markdown语法支持完整
- [ ] 实时预览准确，与最终渲染效果一致
- [ ] 工具栏操作流畅，快捷键响应及时
- [ ] 代码块语法高亮正确

---

#### 2.2.2 图片上传功能

**功能要求**：
- **粘贴上传**：支持从剪贴板粘贴图片（Ctrl+V / Cmd+V）
- **拖拽上传**：支持拖拽图片文件到编辑器区域
- **点击上传**：支持点击工具栏按钮选择图片文件上传
- **自动上传**：图片自动上传到服务器
- **格式转换**：图片上传后自动转换为Markdown格式（`![alt](url)`）
- **上传进度**：显示图片上传进度
- **图片预览**：支持在编辑器中预览已上传的图片
- **图片删除**：支持删除已插入的图片

**图片要求**：
- 支持格式：JPG、PNG、GIF、WebP、SVG
- 文件大小限制：单张图片最大5MB
- 图片压缩：超过2MB的图片自动压缩
- 图片存储：上传到服务器，返回URL

**验收标准**：
- [ ] 粘贴图片操作流畅，无需额外步骤
- [ ] 拖拽上传体验良好
- [ ] 图片上传速度快，有上传进度提示
- [ ] 图片URL自动插入到Markdown中正确位置
- [ ] 支持所有常见图片格式
- [ ] 图片大小限制和压缩功能正常
- [ ] 图片预览和删除功能正常

---

#### 2.2.3 编辑器工具栏

**工具栏按钮**：
- **文本格式**：
  - 加粗（B）：`**文本**`
  - 斜体（I）：`*文本*`
  - 删除线（S）：`~~文本~~`
  - 代码（`</>`）：`` `代码` ``
- **标题**：
  - H1、H2、H3、H4、H5、H6
- **列表**：
  - 有序列表
  - 无序列表
  - 任务列表（复选框）
- **插入**：
  - 链接
  - 图片
  - 表格
  - 代码块
  - 引用
  - 水平线
- **其他**：
  - 撤销（Undo）
  - 重做（Redo）
  - 全屏编辑

**验收标准**：
- [ ] 工具栏按钮清晰易用
- [ ] 所有按钮功能正常
- [ ] 按钮操作有视觉反馈
- [ ] 快捷键支持完整

---

### 2.3 页面布局设计

#### 2.3.1 页面结构

```
┌─────────────────────────────────────────────────┐
│  面包屑导航  [返回任务列表]                     │
├─────────────────────────────────────────────────┤
│  任务创建                                       │
├─────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────┐  │
│  │  基本信息区域                             │  │
│  │  - 任务标题（必填）                       │  │
│  │  - 所属项目（下拉选择）                   │  │
│  │  - 拟投入人天（必填）                     │  │
│  │  - 所需技能（可选）                       │  │
│  │  - 截止时间（可选）                       │  │
│  └──────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────┐  │
│  │  任务描述区域（Markdown编辑器）          │  │
│  │  ┌──────────────┬──────────────────────┐ │  │
│  │  │  编辑区       │  预览区              │ │  │
│  │  │  [工具栏]     │  [实时预览]          │ │  │
│  │  │  ┌──────────┐│  ┌────────────────┐ │ │  │
│  │  │  │          ││  │                │ │ │  │
│  │  │  │ Markdown ││  │  Rendered HTML │ │ │  │
│  │  │  │  编辑    ││  │  预览          │ │ │  │
│  │  │  │          ││  │                │ │ │  │
│  │  │  └──────────┘│  └────────────────┘ │ │  │
│  │  └──────────────┴──────────────────────┘ │  │
│  └──────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────┐  │
│  │  操作按钮区域                             │  │
│  │  [保存草稿] [取消] [创建任务]            │  │
│  └──────────────────────────────────────────┘  │
└─────────────────────────────────────────────────┘
```

#### 2.3.2 响应式设计

- **桌面端**：编辑区和预览区并排显示（50% / 50%）
- **平板端**：编辑区和预览区可以切换显示
- **移动端**：编辑区和预览区上下排列，支持切换标签页

**验收标准**：
- [ ] 页面布局清晰，信息层次分明
- [ ] 编辑区域宽敞，使用体验良好
- [ ] 响应式布局适配不同屏幕尺寸
- [ ] 移动端体验良好

---

### 2.4 数据保存与草稿

#### 2.4.1 草稿保存

**功能要求**：
- 自动保存草稿（每30秒或失去焦点时）
- 手动保存草稿按钮
- 草稿存储在本地（localStorage）或服务器
- 下次进入创建页面时自动加载草稿

**验收标准**：
- [ ] 草稿自动保存及时，不丢失内容
- [ ] 手动保存草稿功能正常
- [ ] 草稿加载功能正常

#### 2.4.2 表单验证

**验证规则**：
- 任务标题：必填，长度1-200字符
- 所属项目：可选
- 拟投入人天：必填，大于0
- 任务描述：可选，支持Markdown格式
- 所需技能：可选
- 截止时间：可选，必须是未来日期

**验收标准**：
- [ ] 所有验证规则正确执行
- [ ] 错误提示清晰明确
- [ ] 提交前验证完整

---

### 2.5 任务编辑功能扩展

#### 2.5.1 编辑已有任务

**功能要求**：
- 任务详情页支持编辑功能
- 编辑时使用相同的Markdown编辑器
- 编辑后保存更新任务描述

**验收标准**：
- [ ] 编辑功能正常
- [ ] 编辑器可以加载已有内容
- [ ] 更新后内容正确保存

---

## 三、非功能性需求

### 3.1 性能要求

- 编辑器加载时间 < 2秒
- 图片上传响应时间 < 5秒（单张）
- 实时预览响应时间 < 100ms
- 页面切换流畅，无卡顿

### 3.2 兼容性要求

- 支持Chrome、Firefox、Safari、Edge最新版本
- 支持移动端浏览器（iOS Safari、Chrome Mobile）
- 支持键盘操作（无障碍访问）

### 3.3 安全性要求

- 图片上传需要验证文件类型和大小
- 防止XSS攻击（Markdown渲染时转义）
- 图片URL需要验证，防止恶意链接

---

## 四、用户体验要求

### 4.1 操作流程

1. 用户在任务列表页面点击"创建任务"按钮
2. 跳转到任务创建页面
3. 填写基本信息（标题、项目、人天等）
4. 在Markdown编辑器中编写任务描述
5. 可以插入图片、代码块等
6. 实时预览效果
7. 点击"创建任务"提交
8. 创建成功后跳转到任务详情页或任务列表

### 4.2 交互细节

- 编辑器工具栏按钮有悬停提示
- 图片上传有进度提示
- 表单验证错误有明确提示
- 保存草稿有成功提示
- 创建成功有成功提示

---

## 五、验收标准总结

### 5.1 功能完整性

- [ ] 任务创建页面独立存在
- [ ] Markdown编辑器功能完整
- [ ] 图片上传功能正常
- [ ] 工具栏操作正常
- [ ] 实时预览功能正常
- [ ] 草稿保存功能正常
- [ ] 表单验证完整

### 5.2 用户体验

- [ ] 页面布局合理，使用体验良好
- [ ] 编辑器操作流畅
- [ ] 图片上传体验良好
- [ ] 响应式布局适配良好
- [ ] 错误提示清晰

### 5.3 技术质量

- [ ] 代码结构清晰，可维护
- [ ] 性能满足要求
- [ ] 安全性满足要求
- [ ] 兼容性满足要求

---

## 六、后续扩展

### 6.1 可选功能

- 任务描述模板（快速创建常用任务）
- 任务描述历史版本（查看修改历史）
- 任务描述导出（导出为PDF、Word等）
- 协作编辑（多人同时编辑，实时同步）

### 6.2 集成功能

- 与知识分享功能共享Markdown编辑器组件
- 任务描述支持引用知识文章
- 任务描述支持@提及用户

---

**文档维护**：本文档随项目发展持续更新，重大变更需团队评审。
