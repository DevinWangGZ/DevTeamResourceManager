# 任务系统测试指南

> **文档版本**：v1.0 | **更新日期**：2024-05

## 测试环境准备

### 1. 确保服务运行

```bash
# 检查服务状态
make check

# 或手动启动
# 后端
make dev-backend

# 前端（新终端）
make dev-frontend
```

### 2. 访问地址

- **前端应用**：http://localhost:5173
- **后端API文档**：http://localhost:8000/docs
- **后端健康检查**：http://localhost:8000/health

## 功能测试清单

### 一、用户认证测试

#### 1.1 登录测试
- [ ] 使用有效用户名和密码登录
- [ ] 验证登录成功后跳转到首页
- [ ] 验证Token正确存储
- [ ] 测试无效用户名/密码的错误提示

#### 1.2 注册测试
- [ ] 注册新用户
- [ ] 验证注册后自动登录
- [ ] 测试重复用户名/邮箱的错误提示

### 二、任务管理基础功能测试

#### 2.1 创建任务（项目经理角色）

**测试步骤**：
1. 使用项目经理账号登录（如：pm001）
2. 进入任务管理页面
3. 点击"创建任务"按钮
4. 填写任务信息：
   - 任务标题：测试任务001
   - 任务描述：这是一个测试任务
   - 拟投入人天：5.0
   - 所需技能：Python, FastAPI
   - 截止时间：选择未来日期
5. 点击"创建"按钮

**预期结果**：
- [ ] 任务创建成功
- [ ] 任务状态为"草稿"
- [ ] 任务出现在任务列表中

#### 2.2 发布任务

**测试步骤**：
1. 在任务列表中，找到刚创建的草稿任务
2. 点击"查看"进入详情页
3. 点击"发布"按钮
4. 确认发布

**预期结果**：
- [ ] 任务状态变为"已发布"
- [ ] 任务可以在任务集市中看到
- [ ] 开发人员可以认领此任务

#### 2.3 认领任务（开发人员角色）

**测试步骤**：
1. 使用开发人员账号登录（如：dev001）
2. 进入任务管理页面
3. 找到状态为"已发布"的任务
4. 点击"认领"按钮
5. 确认认领

**预期结果**：
- [ ] 任务状态变为"已认领"
- [ ] 任务分配给当前开发人员
- [ ] 自动生成任务排期（排除节假日）
- [ ] 可以在任务详情页查看排期信息

#### 2.4 任务派发（项目经理角色）

**测试步骤**：
1. 使用项目经理账号登录
2. 创建一个新任务并发布
3. 在任务详情页，使用API派发任务给指定开发人员
   ```bash
   curl -X POST http://localhost:8000/api/v1/tasks/{task_id}/assign \
     -H "Authorization: Bearer {token}" \
     -H "Content-Type: application/json" \
     -d '{"assignee_id": {developer_id}}'
   ```

**预期结果**：
- [ ] 任务状态变为"待评估"
- [ ] 任务分配给指定的开发人员
- [ ] 开发人员收到评估通知

#### 2.5 任务评估（开发人员角色）

**测试步骤**：
1. 使用被派发的开发人员账号登录
2. 找到状态为"待评估"的任务
3. 点击"评估"按钮
4. 选择"接受"或"拒绝"

**预期结果**：
- [ ] 接受：任务状态变为"已认领"，自动生成排期
- [ ] 拒绝：任务状态变为"已发布"，可被其他开发人员认领

#### 2.6 开始任务

**测试步骤**：
1. 开发人员认领任务后
2. 在任务详情页点击"开始"按钮

**预期结果**：
- [ ] 任务状态变为"进行中"
- [ ] 可以继续提交任务

#### 2.7 提交任务

**测试步骤**：
1. 在任务详情页点击"提交"按钮
2. 填写实际投入人天（如：6.0）
3. 点击"提交"

**预期结果**：
- [ ] 任务状态变为"已提交"
- [ ] 实际投入人天已保存
- [ ] 项目经理可以确认此任务

#### 2.8 确认任务（项目经理角色）

**测试步骤**：
1. 使用项目经理账号登录
2. 找到状态为"已提交"的任务
3. 点击"确认"按钮
4. 确认操作

**预期结果**：
- [ ] 任务状态变为"已确认"
- [ ] 实际投入人天汇入工作量统计
- [ ] 任务完成

### 三、任务排期功能测试

#### 3.1 自动排期测试

**测试步骤**：
1. 开发人员认领多个任务（如：任务A需要3人天，任务B需要5人天）
2. 查看每个任务的排期信息

**预期结果**：
- [ ] 任务按认领时间顺序排期
- [ ] 排期自动排除周末
- [ ] 排期自动排除法定节假日（如果有）
- [ ] 预计开始时间和结束时间正确

#### 3.2 置顶任务排期调整测试

**测试步骤**：
1. 开发人员认领了任务A（3人天）和任务B（5人天）
2. 任务A的排期：2024-01-01 至 2024-01-05
3. 任务B的排期：2024-01-08 至 2024-01-14
4. 将任务B置顶

**预期结果**：
- [ ] 任务B排在最前面
- [ ] 任务B的排期从今天开始
- [ ] 任务A的排期自动向后延期
- [ ] 延期计算排除节假日

#### 3.3 取消置顶测试

**测试步骤**：
1. 取消已置顶任务的置顶状态

**预期结果**：
- [ ] 任务恢复原排期顺序
- [ ] 其他任务排期相应调整

### 四、任务搜索和筛选测试

#### 4.1 基础筛选测试

**测试步骤**：
1. 在任务列表页面
2. 使用状态筛选（如：选择"已发布"）
3. 使用关键词搜索（如：搜索"测试"）

**预期结果**：
- [ ] 筛选结果正确
- [ ] 关键词搜索匹配标题和描述
- [ ] 筛选条件可以组合使用

#### 4.2 高级筛选测试

**测试步骤**：
1. 点击"展开高级筛选"
2. 设置创建时间范围
3. 设置投入人天范围
4. 设置置顶状态
5. 点击"搜索"

**预期结果**：
- [ ] 高级筛选条件生效
- [ ] 筛选结果准确
- [ ] 可以重置所有筛选条件

### 五、任务详情页测试

#### 5.1 信息展示测试

**测试步骤**：
1. 进入任务详情页
2. 查看所有信息

**预期结果**：
- [ ] 任务基本信息完整显示
- [ ] 任务描述正确显示
- [ ] 所需技能正确显示
- [ ] 排期信息正确显示（如果有）
- [ ] 创建者、认领者信息正确

#### 5.2 操作按钮权限测试

**测试步骤**：
1. 使用不同角色账号登录
2. 查看不同状态的任务详情页
3. 验证操作按钮显示

**预期结果**：
- [ ] 项目经理可以看到"发布"、"确认"按钮
- [ ] 开发人员可以看到"认领"、"评估"、"开始"、"提交"、"置顶"按钮
- [ ] 按钮根据任务状态正确显示/隐藏
- [ ] 只有认领者可以操作自己的任务

### 六、API接口测试

#### 6.1 使用API文档测试

**测试步骤**：
1. 访问 http://localhost:8000/docs
2. 使用Swagger UI测试各个API端点

**测试端点**：
- [ ] `POST /api/v1/tasks` - 创建任务
- [ ] `GET /api/v1/tasks` - 获取任务列表
- [ ] `GET /api/v1/tasks/{id}` - 获取任务详情
- [ ] `PUT /api/v1/tasks/{id}` - 更新任务
- [ ] `POST /api/v1/tasks/{id}/publish` - 发布任务
- [ ] `POST /api/v1/tasks/{id}/claim` - 认领任务
- [ ] `POST /api/v1/tasks/{id}/assign` - 派发任务
- [ ] `POST /api/v1/tasks/{id}/evaluate` - 评估任务
- [ ] `POST /api/v1/tasks/{id}/start` - 开始任务
- [ ] `POST /api/v1/tasks/{id}/submit` - 提交任务
- [ ] `POST /api/v1/tasks/{id}/confirm` - 确认任务
- [ ] `POST /api/v1/tasks/{id}/pin` - 置顶任务
- [ ] `GET /api/v1/tasks/{id}/schedule` - 获取任务排期

**预期结果**：
- [ ] 所有API端点响应正常
- [ ] 错误处理正确
- [ ] 权限控制正确

## 常见问题排查

### 1. 登录失败

**可能原因**：
- 用户不存在或密码错误
- 数据库连接问题
- JWT配置问题

**解决方法**：
```bash
# 检查数据库中的用户
mysql -h 10.254.68.77 -u root -p123456 devteam_manager -e "SELECT username, email, role FROM users;"

# 检查后端日志
# 查看后端控制台输出
```

### 2. 任务排期未生成

**可能原因**：
- 任务未被认领
- 排期服务异常
- 节假日数据未初始化

**解决方法**：
```bash
# 检查任务状态
# 确保任务状态为"已认领"

# 检查节假日数据
mysql -h 10.254.68.77 -u root -p123456 devteam_manager -e "SELECT * FROM holidays LIMIT 10;"
```

### 3. 前端页面无法访问

**可能原因**：
- 前端服务未启动
- 端口被占用
- 路由配置错误

**解决方法**：
```bash
# 检查前端服务
curl http://localhost:5173

# 检查浏览器控制台错误
# 打开浏览器开发者工具查看错误信息
```

### 4. API请求失败

**可能原因**：
- Token过期或无效
- CORS配置问题
- 后端服务异常

**解决方法**：
```bash
# 检查后端服务
curl http://localhost:8000/health

# 检查API文档
# 访问 http://localhost:8000/docs
```

## 测试数据准备

### 创建测试用户

如果需要创建新的测试用户，可以使用注册功能或直接操作数据库：

```sql
-- 创建测试项目经理
INSERT INTO users (username, email, password_hash, full_name, role) VALUES
('test_pm', 'test_pm@test.com', '$2b$12$...', '测试项目经理', 'project_manager');

-- 创建测试开发人员
INSERT INTO users (username, email, password_hash, full_name, role) VALUES
('test_dev', 'test_dev@test.com', '$2b$12$...', '测试开发人员', 'developer');
```

**注意**：密码哈希需要使用应用生成，不能直接使用明文密码。

### 创建测试项目

```sql
-- 创建测试项目
INSERT INTO projects (name, description, estimated_output_value, created_by) VALUES
('测试项目', '这是一个测试项目', 50000.00, (SELECT id FROM users WHERE username = 'test_pm' LIMIT 1));
```

### 创建节假日数据

```sql
-- 插入节假日数据（示例）
INSERT INTO holidays (date, description, is_weekend) VALUES
('2024-01-01', '元旦', false),
('2024-02-10', '春节', false),
('2024-02-11', '春节', false),
('2024-04-04', '清明节', false),
('2024-05-01', '劳动节', false),
('2024-06-10', '端午节', false),
('2024-09-15', '中秋节', false),
('2024-10-01', '国庆节', false);
```

## 性能测试

### 1. 任务列表加载性能

**测试步骤**：
1. 创建大量任务（如：100个）
2. 测试列表加载时间

**预期结果**：
- [ ] 列表加载时间 < 2秒
- [ ] 分页功能正常
- [ ] 筛选功能不影响性能

### 2. 排期计算性能

**测试步骤**：
1. 开发人员认领大量任务（如：20个）
2. 测试排期计算时间

**预期结果**：
- [ ] 排期计算时间 < 1秒
- [ ] 置顶后重新排期时间 < 2秒

## 测试报告模板

测试完成后，请填写以下信息：

```
测试日期：___________
测试人员：___________
测试环境：开发环境 / 测试环境

功能测试结果：
- 任务创建：✅ / ❌
- 任务发布：✅ / ❌
- 任务认领：✅ / ❌
- 任务排期：✅ / ❌
- 任务置顶：✅ / ❌
- 任务提交：✅ / ❌
- 任务确认：✅ / ❌
- 搜索筛选：✅ / ❌

发现的问题：
1. 
2. 
3. 

建议：
1. 
2. 
3. 
```

---

**文档维护**：本文档随功能更新持续完善。
