# DevTeam Manager 项目开发规范

> **文档版本**：v1.0 | **更新日期**：2024-05 | **负责人**：项目组

## 目录
- [项目愿景](#项目愿景)
- [核心设计原则](#核心设计原则)
- [业务规则](#业务规则)
- [技术规范](#技术规范)
- [开发约定](#开发约定)
- [功能优先级](#功能优先级)
- [相关文档](#相关文档)

---

## 项目愿景

打造一个**极简、透明、自助**的内部开发者资源管理与协作平台，解决团队资源匹配、任务分发与工作量量化等核心痛点。

---

## 核心设计原则

### 1. 极简主义 ⚡
**原则**：功能以解决核心痛点为准，非必要不添加。

**实践要求**：
- 每个功能必须对应明确的业务需求，避免"可能有用"的功能
- 优先实现 MVP（最小可行产品），后续根据反馈迭代
- UI/UX 保持简洁，减少认知负担
- 删除功能前需评估影响范围

**反例**：
- ❌ 添加复杂的审批流程
- ❌ 实现"可能用到的"报表功能
- ❌ 过度设计的数据模型

**正例**：
- ✅ 核心任务流程完整可用
- ✅ 关键数据可视化清晰
- ✅ 操作流程简短高效

---

### 2. 去审批化 🚫
**原则**：不设复杂审批流，以"公开透明"和"事后确认"保障数据。

**实践要求**：
- 任务确认采用"点击确认"而非多级审批
- 所有关键数据对相关人员公开可见
- 通过同伴监督和事后核对纠偏
- 记录操作日志，支持追溯

**关键流程**：
```
任务提交 → PM查看 → PM点击确认 → 数据自动汇入统计
（无需审批，无需等待）
```

---

### 3. 用户友好 😊
**原则**：注重开发人员填报体验，通过引导和趣味化设计降低抵触。

**实践要求**：
- 减少必填项，提供合理的默认值
- 操作流程尽可能简短，减少点击次数
- 使用趣味化元素（如情绪标签🚀）
- 提供清晰的引导和帮助提示
- 关键操作有明确的反馈

**设计要点**：
- 表单字段分组，逻辑清晰
- 提供快捷操作入口
- 错误提示友好，指明修正方向
- 支持批量操作（如批量认领任务）

---

### 4. 数据驱动 📊
**原则**：所有分析、报告均基于"投入人天"等客观数据。

**实践要求**：
- 避免主观评价，使用量化指标
- 数据可视化优先于文字描述
- 统计口径统一，确保数据可比性
- 数据来源可追溯，支持核对

**核心指标**：
- **投入人天**：实际投入人天（任务确认后）
- **负荷率**：基于已认领任务的拟投入人天
- **工作量**：按项目/模块/时间维度统计

---

### 5. 信任为先 🤝
**原则**：默认信任用户填报，通过同伴监督和事后核对纠偏。

**实践要求**：
- 不设置复杂的权限控制
- 数据修改记录可追溯
- 关键数据变更有通知机制
- 异常数据自动标记，人工核对

---

## 业务规则

### 人员档案

#### 技能管理
- **格式**：`{技能名, 熟练度:熟悉/熟练/精通}`
- **维护方式**：用户自维护，无需审核
- **规则**：
  - 技能名支持自定义，避免重复
  - 熟练度三档：熟悉（基础）、熟练（常用）、精通（专家）
  - 可随时添加/修改/删除

#### 业务履历
- **格式**：`{项目, 模块, 角色, 贡献描述, 投入人天}`
- **维护方式**：用户自登记
- **规则**：
  - 项目/模块支持选择或输入
  - 角色：开发者/负责人/架构师等
  - 投入人天：支持小数（如 0.5 天）
  - 可关联任务系统，自动同步

#### 状态标签
- **类型**：趣味化情绪标签（如🚀"火力全开"、😴"休息中"）
- **规则**：可选，不影响业务逻辑

#### 序列管理
- **格式**：`{序列等级, 单价(元/人天)}`
- **维护方式**：用户自维护
- **示例**：
  - 初级开发：1500元/人天
  - 中级开发：2000元/人天
  - 高级开发：2500元/人天
- **规则**：
  - 用户可以设置自己的序列等级和对应单价
  - 可以修改序列等级和单价
  - 修改立即生效，用于产值计算
  - 序列信息在个人档案中清晰显示

---

### 任务系统（核心）

#### 生命周期状态流

**主动认领流程**：
```
草稿 → 已发布 → 已认领 → 进行中 → 已提交 → 已确认 → 已归档
```

**派发流程**：
```
草稿 → 已发布 → 待评估 → 已认领（接受）/已发布（拒绝） → 进行中 → 已提交 → 已确认 → 已归档
```

**状态说明**：
- **草稿**：PM创建任务，未发布
- **已发布**：任务发布到任务集市，可被认领
- **待评估**：PM派发任务给指定开发人员，等待评估（仅派发流程）
- **已认领**：开发者认领任务或接受派发任务
- **进行中**：开发者开始工作（可选状态）
- **已提交**：开发者提交任务，填写实际投入人天
- **已确认**：PM确认工作量，数据汇入统计
- **已归档**：任务完成，归档保存

#### 任务排期
- **排期规则**：任务认领后自动按认领人天顺序排期
- **排期计算**：基于任务的"拟投入人天"，排除节假日（周末、法定节假日），只计算工作日
- **排期显示**：在个人工作台显示预计开始时间和结束时间

#### 任务置顶
- **置顶功能**：开发人员可以将紧急任务置顶，优先处理
- **置顶规则**：
  - 置顶后任务排在最前面，优先处理
  - 如果当前有正在处理的B任务，置顶A任务后，B任务按照未完成的人天向后自动延期
  - 延期计算排除节假日
  - B任务及其后续任务自动调整排期
- **取消置顶**：可以取消置顶，恢复原排期顺序

#### 关键字段

| 字段 | 填写人 | 填写时机 | 说明 |
|------|--------|----------|------|
| 拟投入人天 | PM | 发布时 | 预估工作量 |
| 实际投入人天 | 开发者 | 提交时 | 实际工作量 |
| 确认状态 | PM | 确认时 | 点击确认，非审批 |

#### 数据流规则
1. **任务确认后**：`实际投入人天` 自动汇入开发者工作量统计
2. **负荷计算**：基于已认领任务的 `拟投入人天` 和时间分布
3. **数据一致性**：确认后的任务数据不可修改（需特殊权限）

---

### 团队资源视图

#### 负荷计算
- **基础数据**：已认领任务的 `拟投入人天` 和时间分布
- **计算维度**：按周/月统计
- **显示方式**：时间轴视图 + 负荷看板

#### 可视状态
- **🔴 红色（过载）**：负荷 > 120%
- **🟡 黄色（适中）**：负荷 80% - 120%
- **🟢 绿色（空闲）**：负荷 < 80%

---

## 技术规范

### 代码质量

#### 模块化
- 代码按功能模块组织，职责清晰
- 关键业务逻辑必须有注释
- 公共组件/工具函数统一管理

#### 设计原则
- **单一职责**：每个函数/类只做一件事
- **开闭原则**：对扩展开放，对修改关闭
- **依赖倒置**：依赖抽象而非具体实现

#### 状态管理
- 核心状态流设计为可插拔架构
- 状态变更统一管理，避免分散
- 状态流转有明确的规则和校验

---

### 性能要求

| 指标 | 要求 | 说明 |
|------|------|------|
| 列表页加载 | < 2秒 | 包含分页、筛选 |
| 关键操作响应 | < 1秒 | 如认领任务、提交任务 |
| 数据查询 | 优化索引 | 避免全表扫描 |
| 缓存策略 | 合理使用 | 热点数据缓存 |

**优化建议**：
- 数据库查询优化，避免 N+1 问题
- 列表数据分页加载
- 图片/静态资源 CDN 加速
- 前端组件懒加载

---

### 安全性

#### 权限校验
- **接口权限**：所有接口必须校验用户权限
- **数据隔离**：用户只能访问授权范围内的数据
- **角色控制**：基于角色的访问控制（RBAC）

#### 数据安全
- **防XSS注入**：所有用户输入必须转义/验证
- **SQL注入防护**：使用参数化查询
- **CSRF防护**：关键操作使用 CSRF Token

#### 操作审计
- **日志记录**：关键操作记录操作日志
- **数据追溯**：数据修改记录可追溯
- **异常监控**：异常操作自动告警

---

### 可维护性

#### 代码结构
```
project/
├── src/
│   ├── modules/          # 业务模块
│   │   ├── task/         # 任务模块
│   │   ├── user/         # 用户模块
│   │   └── ...
│   ├── common/           # 公共组件/工具
│   ├── config/           # 配置文件
│   └── ...
├── docs/                 # 文档
└── tests/                # 测试
```

#### 注释规范
- **关键业务逻辑**：必须有注释说明
- **复杂算法**：注释算法思路
- **接口文档**：API 接口必须有文档

#### 错误处理
- 统一的错误处理机制
- 错误信息友好，便于排查
- 异常情况有降级方案

---

### 可扩展性

#### 架构设计
- **核心状态流可插拔**：便于后续增加审批流
- **配置化**：业务规则使用配置管理
- **插件机制**：预留扩展点

#### 数据模型
- **版本兼容**：数据结构变更考虑向后兼容
- **数据迁移**：提供数据迁移脚本
- **扩展字段**：预留扩展字段（如 JSON 字段）

---

## 开发约定

### 命名规范

#### 变量/函数命名
- 使用有意义的名称，避免缩写
- 遵循技术栈的命名约定（如驼峰、下划线）
- 布尔变量使用 `is/has/can` 前缀

#### 状态枚举
```javascript
// 任务状态
const TaskStatus = {
  DRAFT: 'draft',           // 草稿
  PUBLISHED: 'published',   // 已发布
  CLAIMED: 'claimed',       // 已认领
  IN_PROGRESS: 'in_progress', // 进行中
  SUBMITTED: 'submitted',   // 已提交
  CONFIRMED: 'confirmed',   // 已确认
  ARCHIVED: 'archived'      // 已归档
}
```

---

### 数据模型

#### 数据类型
- **人天数据**：统一使用浮点数（支持 0.5 天）
- **时间字段**：统一使用时间戳或 ISO 8601 格式
- **状态字段**：使用枚举类型，避免字符串硬编码

#### 数据校验
- **前端校验**：提供即时反馈
- **后端校验**：确保数据完整性
- **业务规则校验**：状态流转规则校验

---

### API 设计

#### RESTful 规范
```
GET    /api/tasks           # 获取任务列表
POST   /api/tasks           # 创建任务
GET    /api/tasks/:id       # 获取任务详情
PUT    /api/tasks/:id       # 更新任务
DELETE /api/tasks/:id       # 删除任务
POST   /api/tasks/:id/claim # 认领任务
POST   /api/tasks/:id/submit # 提交任务
POST   /api/tasks/:id/confirm # 确认任务
```

#### 响应格式
```json
{
  "code": 200,
  "message": "success",
  "data": {},
  "timestamp": 1234567890
}
```

#### 错误码规范
- `200`：成功
- `400`：请求参数错误
- `401`：未授权
- `403`：无权限
- `404`：资源不存在
- `500`：服务器错误

---

### 前端技术栈与开发规范

> **详细规范请参考**：[前端开发规范文档](./FRONTEND_RULES.md)

**核心技术栈**：
- Vue 3.4+ (组合式API, `<script setup>`)
- TypeScript 5.3+
- Vite 5.0+
- Element Plus 2.4+
- Pinia 2.1+ (状态管理)
- Vue Router 4.2+ (路由)
- Axios 1.6+ (HTTP客户端)
- ECharts 5.4+ (数据可视化)

**关键规范要点**：
- 组件使用`<script setup>`语法，Props/Emits使用TypeScript类型定义
- 状态管理使用Pinia，按模块划分store
- API层统一使用Axios拦截器，按模块划分API文件
- 样式使用`<style scoped>` + Element Plus主题变量
- 路由组件使用动态import实现懒加载
- 性能优化：组件懒加载、图片懒加载、API缓存

---

### 后端技术栈与开发规范

> **详细规范请参考**：[后端开发规范文档](./BACKEND_RULES.md)

**核心技术栈**：
- Python 3.12
- FastAPI 0.104+ (异步Web框架)
- SQLAlchemy 2.0+ (ORM)
- Alembic 1.13+ (数据库迁移)
- PostgreSQL 15+ (生产数据库)
- Pydantic 2.5+ (数据验证)
- Python-Jose 3.3+ (JWT认证)

**关键规范要点**：
- API端点使用FastAPI Router，按模块划分端点文件
- 使用依赖注入管理数据库会话和用户认证
- 业务逻辑集中在service层，不直接在端点中处理
- 使用Pydantic模式进行请求/响应验证
- 数据库模型使用SQLAlchemy ORM，状态字段使用枚举类型
- 使用Alembic进行数据库迁移管理
- 测试使用Pytest，覆盖API、服务、模型各层

---

## 功能优先级

### P0（核心功能，必须实现）
1. ✅ 用户认证与角色管理
2. ✅ 任务系统（发布、认领、提交、确认）
3. ✅ 人员档案管理（技能、履历）
4. ✅ 工作量统计（基于实际投入人天）

### P1（重要功能，优先实现）
1. ⏳ 负荷可视化（个人/团队）
2. ⏳ 任务集市（浏览、筛选、认领）
3. ⏳ 管理仪表盘（团队指标、待办提醒）
4. ⏳ 绩效数据可视化

### P2（增强功能，后续迭代）
1. 📋 智能匹配（基于需求的候选人推荐）
2. 📋 团队能力洞察（技能矩阵、人才梯队分析）
3. 📋 数据导出功能
4. 📋 消息通知系统
5. 📋 知识分享（Markdown编辑器、图片上传、文章管理）

---

## 注意事项

### ⚠️ 开发时需特别注意

1. **避免过度设计**
   - 先实现核心功能，再考虑扩展
   - 不要为了"可能有用"的功能增加复杂度

2. **保持数据一致性**
   - 任务确认后的人天数据必须准确汇入统计
   - 状态流转必须有明确的规则和校验

3. **用户体验优先**
   - 减少操作步骤，提供快捷入口
   - 关键操作有明确的反馈

4. **数据透明**
   - 关键数据对所有相关人员可见
   - 数据修改记录可追溯

5. **向后兼容**
   - 数据结构变更时考虑数据迁移方案
   - API 版本管理，避免破坏性变更

---

## 相关文档

### 技术规范
- [前端开发规范](./FRONTEND_RULES.md) - Vue 3 + TypeScript + Vite 开发规范
- [后端开发规范](./BACKEND_RULES.md) - Python + FastAPI + SQLAlchemy 开发规范
- [日志与错误处理规范](./LOGGING_ERROR_HANDLING.md) - 统一的日志和错误处理规范

### 开发流程
- [开发指南](./DEVELOPMENT_GUIDE.md) - Git工作流、代码提交、代码审查流程

### 项目文档
- [项目README](../README.md) - 项目概述和快速开始指南
- [需求规格说明书](./requirements/SPECIFICATION.md) - 项目需求规格说明
- [用户故事](./requirements/USER_STORIES.md) - 用户故事集合

---

## 更新日志

| 版本 | 日期 | 更新内容 | 负责人 |
|------|------|----------|--------|
| v1.0 | 2024-05 | 初始版本，制定核心规则 | 项目组 |

---

**文档维护**：本文档随项目发展持续更新，重大变更需团队评审。
